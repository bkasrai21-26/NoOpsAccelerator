///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2021-2022 Microsoft Corporation. All rights reserved. This
// Software is licensed under the MIT License. See LICENSE in the project root
// for license information.
///////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Module Description : 
// This module creates end point for key vault 
//
// Assign appropriate values as needed. If needed override global parameters
//
///////////////////////////////////////////////////////////////////////////////////////////////////////
targetScope = 'resourceGroup'

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep parameters
///////////////////////////////////////////////////////////////////////////////////////////////////////
@description('The key vault name')
param p_keyVaultName string

resource keyVaultExists 'Microsoft.KeyVault/vaults@2019-09-01'  existing = {
  name: p_keyVaultName
}

@description('Status of  keyvault end point')
@allowed([
'Approved'
'Disconnected'
'Pending'
'Rejected'
])
param p_status string = 'Approved'

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep resources
///////////////////////////////////////////////////////////////////////////////////////////////////////

resource keyVaultEndpoints 'Microsoft.KeyVault/vaults/privateEndpointConnections@2019-09-01' = {
  name: 'ep-${p_keyVaultName}'
  parent: keyVaultExists
  properties: {
    privateEndpoint: {}
    privateLinkServiceConnectionState: {
      description: 'Key vault end point created via Bicep'
      status: p_status
    }
  }
 }

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep output
///////////////////////////////////////////////////////////////////////////////////////////////////////
