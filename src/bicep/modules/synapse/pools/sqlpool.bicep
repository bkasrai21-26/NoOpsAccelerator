///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2021-2022 Microsoft Corporation. All rights reserved. This
// Software is licensed under the MIT License. See LICENSE in the project root
// for license information.
///////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Module Description : 
// This module creates Synapse Workspace. A wait time is introduced so that activate workspace succeeds. 
//
// Assign appropriate values as needed. If needed override global parameters
//
///////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep parameters
///////////////////////////////////////////////////////////////////////////////////////////////////////

@description('Prefix for  Synapse Workspace Name.')
param o_workspaceName string

@description('Prefix for  resource name')
param p_nameIdentifier string

@description('Select the SKU of the SQL pool.')
@allowed([
  'DW100c'
  'DW200c'
  'DW300c'
  'DW400c'
  'DW500c'
  'DW1000c'
  'DW1500c'
  'DW2000c'
  'DW2500c'
  'DW3000c'
])
param p_SKU string = 'DW100c'

@description(' ')
param p_collation string = 'SQL_Latin1_General_CP1_CI_AS'

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep variables
///////////////////////////////////////////////////////////////////////////////////////////////////////

var v_location = resourceGroup().location
var v_sqlPoolName = take(toLower('synsqlpool${p_nameIdentifier}'), 15)

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep resources
///////////////////////////////////////////////////////////////////////////////////////////////////////

resource synapseSQLPool 'Microsoft.Synapse/workspaces/sqlPools@2019-06-01-preview' = {
  name: '${o_workspaceName}/${v_sqlPoolName}'
  location: v_location
  sku: {
    name: p_SKU
  }
  properties: {
    createMode: 'Default'
    collation: p_collation
  }
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Output Section
///////////////////////////////////////////////////////////////////////////////////////////////////////

output o_sqlResourceId string = synapseSQLPool.id
output o_sqlPoolName string = synapseSQLPool.name
output o_sqlPoolLocation string = synapseSQLPool.location
