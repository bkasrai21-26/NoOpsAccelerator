///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2021-2022 Microsoft Corporation. All rights reserved. This
// Software is licensed under the MIT License. See LICENSE in the project root
// for license information.
///////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Module Description : 
// This module implememts firewall for Synapse workspace
//
// Assign appropriate values as needed. If needed override global parameters
//
///////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep parameters
///////////////////////////////////////////////////////////////////////////////////////////////////////

@description('Synapse Workspace')
param o_workspaceName string

@description('Prefix for  resource name')
param p_nameIdentifier string

@description('start IP address')
param p_startIpAddress string

@description('end IP address')
param p_endIpAddress string

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep Variables
///////////////////////////////////////////////////////////////////////////////////////////////////////

var v_trimfirewallRuleName = take(toLower('afw-${p_nameIdentifier}'), 15)
var v_firewallRuleName = p_startIpAddress == '0.0.0.0' && p_endIpAddress == '0.0.0.0' ? 'AllowAllWindowsAzureIps' : v_trimfirewallRuleName

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep resources
///////////////////////////////////////////////////////////////////////////////////////////////////////

resource firewallRule 'Microsoft.Synapse/workspaces/firewallrules@2019-06-01-preview' = {
  name: '${o_workspaceName}/${v_firewallRuleName}'
  properties: {
    startIpAddress: p_startIpAddress
    endIpAddress: p_endIpAddress
  }
}

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep Output
///////////////////////////////////////////////////////////////////////////////////////////////////////
