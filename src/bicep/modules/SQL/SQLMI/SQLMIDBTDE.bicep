///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2021-2022 Microsoft Corporation. All rights reserved. This
// Software is licensed under the MIT License. See LICENSE in the project root
// for license information.
///////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Module Description : 
// This module enables alert policies  for Synapse SQL pool
//
// Assign appropriate values as needed. If needed override global parameters
//
///////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep parameters
///////////////////////////////////////////////////////////////////////////////////////////////////////

@description('Enable or Disable TDE')
param p_state string = 'Enabled'

@description('Name of SQL server')
param p_sqlServerName string

@description('SQL database name')
param p_sqlDBName string


///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep variables
///////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep resources
///////////////////////////////////////////////////////////////////////////////////////////////////////

resource sqlServerName 'Microsoft.Sql/managedInstances@2021-05-01-preview' existing = {
  name: p_sqlServerName
}

resource sqlDB 'Microsoft.Sql/managedInstances/databases@2021-05-01-preview' existing = {
  parent: sqlServerName
  name: p_sqlDBName
}

  resource sqlPoolTDE 'Microsoft.Sql/managedInstances/databases/transparentDataEncryption@2021-05-01-preview' = {
    name: 'current'
    parent: sqlDB
    properties: {
      state: p_state
    }
  }
  

///////////////////////////////////////////////////////////////////////////////////////////////////////
// Section for Bicep outout
///////////////////////////////////////////////////////////////////////////////////////////////////////
